name: GitHub Actions
run-name: Update README.md of Flying-Acorn/.github repository
on: [push]
jobs:
    job1:
        name: Create-Markdown-File
        runs-on: ubuntu-latest
        outputs:
            output1: ${{ steps.final.outputs }}
        steps:
            - uses: actions/checkout@v4
            - name: Setup Python
              uses: actions/setup-python@v5.1.1
              with:
                  python-version: '3.10'
            # add trafilatura 1.8.1 to requirements.txt
            - name: Install dependencies
              run: |
                python -m pip install --upgrade pip
                pip install trafilatura==1.8.1
            - name: Generate Markdown
              run: python assets/python/generate_markdown.py --input index.html --output README.md
            - name: Final
              id: final
              run: cat README.md >> "$GITHUB_OUTPUT"
            - name: Go to .github repository
              uses: actions/checkout@v4
              with:
                    repository: 'Flying-Acorn/.github'
                    ref: main
                    token: ${{ secrets.GITHUB_TOKEN }}

            - name: Update readme
              run: |
                echo "${{ needs.job1.outputs.output1 }}" > README.md
            - name: Commit changes
              run: |
                git config --local user.email "amir@flyingacorn.studio"
                git config --local user.name "GitHub Actions"
                git add README.md
                git commit -m "Update README.md"
            - name: Push changes
              uses: ad-m/github-push-action@master
              with:
                github_token: ${{ secrets.GITHUB_TOKEN }}
                branch: ${{ github.ref }}